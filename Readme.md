# Инструкция по установке Telegram MedBot

## Необходимая версия Python: 3.10+

После выполнения команды `git clone` вам необходимо создать виртуальное окружение:  
`python3 -m venv env`

Следующим шагом необходимо запустить виртуальное окружение:  

Unix:  
`source env/bin/activate`  

Windows:  
`env/bin/activate.bat`  

Далее необходимо установить все зависимости:  
`pip install -r requirements.txt`

После установки зависимостей необходимо указать значение токена для телграм бота и путь к базе данных в переменные виртуальной среды:  
По умолчанию значение базы данных: `sqlite:///data/temp.db`  

Unix:  
1. `export BOT_TOKEN="..."`  
2. `export DB_PATH="..."`  

Windows:  
1. `SET BOT_TOKEN="..."`  
2. `SET DB_PATH="..."`  

После установки переменных виртуальный среды необходимо запустить файл для генерации данных в базе данных:  
`python3 generate_db.py`  

После генерации базы данных можно запустить бота следующей командой:  
`python3 bot.py`  

### Бот успешно запущен!


# Техническое и структурное описание Telegram Бота

Все данные в боте связываются с базой данных: Пользователи, Вопросы от пользователей, Контекстные ответы на вопросы, Вопросы для квиза, Заболевания по симптомам (для квиза), Сотрудники и Учреждения.
Все модели описаны в файле `models.py`

Чтобы назначить пользователя администратором, необходимо изменить значение поля `is_admin` в базе данных в таблице `users`. Пользователь появится в базе данных сразу после использования команды `/start`.

Все сообщения, которые бот отправляет пользователям находятся в фaйле `data/messages.json`. Их можно редактировать, но после изменения сообщений необходимо перезапустить бота.

Все логи бибилиотеки aiogram сохраняются в папку `logs/`. В названии содержат точное время запуска.

Вся обработка сообщений и callback\`ов пользователей находится в папке handlers и разделена на обработку запросов администраторов и обычных пользователей.

Каждое отдельное меню Telegram бота вынесено в отдельный python файл.

В файле `states.py` описаны все классы State Manager для aiogram.

В файле `keyboards.py` описаны все статические клавиатуры, используемые Telegram ботом.



# Эксплуатация Telegram бота для пользователей

Все реализованные функции в Telegram боте полностью соответствуют заявленному техническому заданию.
Каждое отдельно взятое меню выполняет все заданные функции.

Кнопка `запись к врачу` отображает ссылку на запись на сайте госуслуги.  
Кнопка `Симптомы` позволяет пользователю пройти простой квиз с ответами Да или Нет и в результате определяет возможные заболевания.  
Кнопка `Задать вопрос` позволяет пользователю задать произвольный вопрос, ответ на который ищется по совпадениям лемм в базе данных.  
Кнопка `Информация` позволяет пользователю получить полную информацию по учреждениям, по сотрудникам и контактную информацию. Данные об учреждениях и сотрудниках берутся из базы данных.  
Кнопка `Обратиться в поддержку` позволяет задать вопрос напрямую администраторам, посмотреть историю вопросов и ответов на вопросы.  
Кнопка `Помощь` выводит краткую информацию о всех пунктах меню.  


# Возможности администрации в Telegram боте

Каждый пользователь, который имеет статус is_admin в таблице базы данных имеет возможность использовать команду `/admin`.  

Администратор обладает следующими возможностями:  
Кнопка `Вопросы пользователей` открывает доступ ко всем вопросам пользователей. К новым и уже отвеченным. Администратор имеет право ответить на новые вопросы пользователей или посмотреть историю всех вопросов.  
Кнопка `Обновить ссылку` позволяет администратору в случае форс-мажора обновить ссылку, которая выдается пользователям для записи к врачу на сайте госуслуг.  
Кнопка `Уведомления` позволяет администратору включить/отключить уведомления от Telegram бота. (Уведомления появляются в случаях, когда пользователи запрашивают обновление ссылки на госуслуги или когда появляется новый вопрос для поддержки)  

Другой функционал не был запрошен в техническом задании.
